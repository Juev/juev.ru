---
title: "Adguard на защите дома"
date: 2022-02-20T17:15:35+0300
image: https://static.juev.org/2022/02/adguard-home-logo.png
tags: 
  - adguard
  - tailscale
---

Ранее пробовал размещать на своем сервере pi-hole, описывал про это в статье [Wireguard and Pi-Hole](https://www.juev.org/2020/05/01/wireguard-pi-hole/). Но данная схема у меня продержалась не долго. Причин было довольно много, останавливаться подробно на них не буду.

В 2020 году стал обладателем [Raspberry Pi](https://www.juev.org/tags/raspberrypi/), микрокомпьютера, который долгое время у меня был не востребованным. Только последние несколько месяцев стал использовать его как файловый сервер, запустив на нем [Syncthing](https://syncthing.net).

## Adguard Home

На днях решил установить в домашней сети сервис [Adguard Home](https://adguard.com/ru/adguard-home/overview.html) для блокировки рекламы на уровне DNS. Установка прошла менее чем за пару минут, используя одну команду:

```bash
curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v
```

После чего сервис уже работает, но требует настройки. Для чего в браузере открываем хост малинки по 3000 порту. Будет предложен мастер из нескольких шагов, по прохождению которого необходимо будет создать пользователя для администрирования, и задать основные параметры работы.

По завершению работы мастера DNS-сервер начинает свою работу, и веб-интерфейс становиться доступным по адресу, заданному в мастере настройки. Так выглядит первая страница, содержащая статистику работы:

![](https://static.juev.org/2022/02/adguard_home.png)

В настройках DNS можно задать Upstream DNS-серверы, для себя я выбрал cloudflare-dns с использованием параллельных запросов:

```plain
tls://security.cloudflare-dns.com
https://security.cloudflare-dns.com/dns-query
```

В черных списках фильтрации перепробовал целый ряд фильтров, но в итоге остановился на трех:

```plain
https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt
https://adaway.org/hosts.txt
https://v.firebog.net/hosts/Easyprivacy.txt
```

Первые два предлагается использовать по умолчанию, при этом второй выключен. А третий нашел и добавлял самостоятельно.

Установка очень простая, как и использование. В отличие от pi-hole, не требуется устанавливать дополнительных пакетов, типа веб-сервера или проводить каких-либо дополнительных настроек. Все очень прозрачно.

Настроить использование Adguard Home в домашней сети просто, достаточно было в параметрах DHCP роутера указать новый IP-адрес для DNS-сервера.

## Tailscale

Использование блокировки рекламы в домашней сети -- это хорошо, но хотелось бы использовать ее везде. С использованием [Tailscale](https://tailscale.com) это стало возможным. Добавляем в свою приватную сеть машинку, с установленным Adguard, добавляем необходимые устройства, после чего проводим настройку Magic DNS:

![](https://static.juev.org/2022/02/tailscale-dns.png)

В Global Nameservers указываем внутренний адрес малинки, и обязательно включаем переопределение локальных dns-серверов. После чего на всех устройствах, на которых работает Tailscale в качестве DNS-сервера будет использоваться наш Adguard Home. При этом уже совершенно не важно, в какой именно сети вы находитесь и какое устройство используете.

В результате получилась простая, но эффективная схема по избавлению от рекламы и веб-жучков на всех устройствах дома, в том числе за его пределами. А Tailscale позволяет так же управлять сервером из любой точки мира, не открывая доступ к серверу в интернете.

