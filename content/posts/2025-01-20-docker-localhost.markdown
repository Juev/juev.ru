---
title: "Docker proxy with localhost"
date: 2025-01-20T11:10:02+0300
tags: 
  - docker
---

Использую Synology NAS как файловый сервер, плюс на нем же крутиться виртуальный сервер. Есть ограниченный доступ
в глобальную сеть и настроен доступ в полноценный интернет через прокси сервер. Причем прокси-сервер работает на
этом же NAS.

Решил попробовать перенести FreshRSS с хостинга на свой виртуальный сервер. Запустить и настроить не составило труда.
А вот интеграция с прокси оказалась не так проста. Если бы прокси был внешним, то обратиться к нему из работающего
контейнера не составило бы труда. Но когда прокси оказывается локальным, обратиться к нему корректно без дополнительных
настроек не удасться.

Добавляем в `compose.yaml` дополнительную секцию `extra_hosts`:

```docker
    extra_hosts:
      - "host.docker.internal:host-gateway"
```

Данная секция определяет в контейнере файл hosts, в котором проводиться сопоставление доменнов с определенными
ip-адресами. В данном случае мы передаем `host-gateway`, который разрешается в ip-адрес хост-системы.

И теперь в контейнере можно обращаться к сервису на localhost по доменному имени `host.docker.internal`, пример части
конфигурации для FreshRSS:

```php
  'curl_options' =>
  array (
    CURLOPT_PROXYTYPE => CURLPROXY_SOCKS5,
    CURLOPT_PROXY => 'host.docker.internal',
    CURLOPT_PROXYPORT => 8080,
  ),
```

Приведенный пример относиться к настройке прокси. Но может быть использован для соединения с любыми локально работающими
сервисами.
